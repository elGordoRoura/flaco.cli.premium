<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flaco AI</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo">
                    <img src="assets/flaco-logo.svg" alt="Flaco AI" class="logo-icon" width="32" height="32">
                    <h1>Flaco AI</h1>
                </div>
                <div class="header-stats">
                    <span class="stat" id="agent-indicator" title="Click to see agent details">
                        <span class="stat-icon" id="current-agent-icon">ü§ñ</span>
                        <span id="current-agent-display">Flaco AI</span>
                    </span>
                    <span class="stat" id="status-indicator">
                        <span class="status-dot"></span>
                        <span>Ready</span>
                    </span>
                    <button class="header-btn danger" id="deleteMessagesBtn" onclick="deleteSelectedMessages()" title="Delete selected messages or entire chat" style="display: none;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 6h18M9 6V4h6v2m-8 0v14a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6" stroke-linecap="round"/>
                            <path d="M10 11v6M14 11v6" stroke-linecap="round"/>
                        </svg>
                    </button>
                    <button class="header-btn" onclick="startCodeReview()" title="Prime a code review">
                        üîç
                    </button>
                    <button class="header-btn" onclick="importFile()" title="Import Markdown File">
                        üìÅ
                    </button>
                    <button class="header-btn" onclick="exportConversation()" title="Export Conversation (Markdown)">
                        üíæ
                    </button>
                    <button class="header-btn" onclick="refreshFlacoContext()" title="Refresh flaco.md Context">
                        üîÑ
                    </button>
                    <button class="settings-btn" onclick="openSettings()" title="Settings">
                        ‚öôÔ∏è
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <div class="chats-header">
                        <h3>Your Chats</h3>
                        <button class="add-chat-btn" onclick="createNewChat()" title="New Chat">
                            <span>+</span>
                        </button>
                    </div>
                    <div class="chat-controls">
                        <input type="text" id="chatSearch" class="chat-search-input" placeholder="Search chats..." oninput="filterChats()">
                        <div class="chat-sort-wrapper">
                            <button class="chat-sort-btn" onclick="toggleSortMenu()" title="Chat options">
                                ‚öôÔ∏è
                            </button>
                            <div class="chat-sort-menu" id="chatSortMenu">
                                <button data-mode="newest" onclick="setSortMode('newest')">Sort: Newest first</button>
                                <button data-mode="name" onclick="setSortMode('name')">Sort: Alphabetical</button>
                            </div>
                        </div>
                    </div>
                    <div class="chat-list" id="chatList">
                        <!-- Chats will be dynamically loaded here -->
                        <div class="no-chats-message">
                            <p>Click + to start a new conversation</p>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="agents-header">
                        <h3>Your Agents</h3>
                        <button class="add-agent-btn" onclick="openAgentCreator()" title="Create New Agent">
                            <span>+</span>
                        </button>
                    </div>
                    <div class="agent-list" id="agentList">
                        <!-- Agents will be dynamically loaded here -->
                        <div class="no-agents-message">
                            <p>No agents yet! Create your first specialized agent.</p>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Chat Area -->
                <div class="chat-container">
                    <!-- API Key Warning Banner -->
                    <div id="apiKeyBanner" class="api-key-banner" style="display: none;">
                        <div class="banner-content">
                            <span class="banner-icon">‚ö†Ô∏è</span>
                            <span class="banner-text">No local endpoint configured. Set your Ollama URL in Settings to start chatting.</span>
                            <button class="banner-button" onclick="openSettings()">Open Settings</button>
                            <button class="banner-close" onclick="dismissBanner()">√ó</button>
                        </div>
                    </div>

                <div class="chat-messages" id="chatMessages">
                    <div class="welcome-message">
                        <h2>üëã Welcome to Flaco AI</h2>
                        <p>Your intelligent coding assistant with specialized agents and powerful features.</p>
                        <div class="feature-grid">
                            <div class="feature-card">
                                <span class="feature-icon">ü§ñ</span>
                                <h4>Custom AI Agents</h4>
                                <p>Create specialized agents for any domain</p>
                            </div>
                            <div class="feature-card">
                                <span class="feature-icon">üåü</span>
                                <h4>Agent Swarm Mode</h4>
                                <p>Multi-agent collaboration</p>
                            </div>
                            <div class="feature-card">
                                <span class="feature-icon">üß†</span>
                                <h4>Project Intelligence</h4>
                                <p>Auto-scan and analyze</p>
                            </div>
                            <div class="feature-card">
                                <span class="feature-icon">üìä</span>
                                <h4>Activity Tracking</h4>
                                <p>GitHub-style contributions</p>
                            </div>
                        </div>
                        <p class="hint">Type a message below or use the Quick Actions to get started!</p>
                    </div>
                </div>

                <div class="chat-input-container">
                    <div class="input-wrapper">
                        <textarea
                            id="messageInput"
                            placeholder="Ask Flaco anything... (Cmd+Enter for new line)"
                            rows="4"
                        ></textarea>
                        <button id="sendButton" class="send-btn">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                    <div class="input-footer">
                        <div class="input-hint">
                            Try: "Build a REST API" ‚Ä¢ "Review this code" ‚Ä¢ "Setup Docker" ‚Ä¢ /help for commands
                        </div>
                        <div id="tokenEstimate" class="token-estimate" style="display: none;">
                            <span class="token-count">~0 tokens</span>
                            <span class="token-separator">‚Ä¢</span>
                            <span class="cost-estimate">~$0.00</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Setup Wizard Modal -->
    <div id="setupWizard" class="setup-wizard" style="display: none;">
        <div class="setup-content">
            <button class="setup-back-top" id="setupTopButton" onclick="setupTopButtonAction()" title="Close setup">‚úï</button>
            <!-- Step 1: Welcome -->
            <div id="setupStep1" class="setup-step">
                <div class="setup-header">
                    <h1>ü¶ô Welcome to Flaco AI</h1>
                    <p>Your personal AI coding team that runs locally</p>
                </div>

                <div class="feature-comparison">
                    <h3>What makes Flaco better than ChatGPT?</h3>
                    <div class="comparison-grid">
                        <div class="comparison-item">
                            <span class="check">‚úì</span>
                            <div>
                                <strong>Create custom agents</strong>
                                <p>Craft your own AI team for any workflow</p>
                            </div>
                        </div>
                        <div class="comparison-item">
                            <span class="check">‚úì</span>
                            <div>
                                <strong>Project Intelligence</strong>
                                <p>Auto-scan and understand your codebase</p>
                            </div>
                        </div>
                        <div class="comparison-item">
                            <span class="check">‚úì</span>
                            <div>
                                <strong>Privacy First</strong>
                                <p>All conversations stay on your machine</p>
                            </div>
                        </div>
                        <div class="comparison-item">
                            <span class="check">‚úì</span>
                            <div>
                                <strong>Git Integration</strong>
                                <p>Built-in version control operations</p>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="setup-btn-primary" onclick="startLocalSetup()">Get Started ‚Üí</button>
            </div>

            <!-- Step 2: Local AI Setup -->
            <div id="setupStep3" class="setup-step" style="display: none;">

                <div class="setup-header">
                    <h2>üè† Setup Local AI</h2>
                    <p>Configure Ollama for 100% private, offline AI</p>
                </div>

                <div class="api-key-form">
                    <div class="form-group">
                        <label>Ollama Endpoint</label>
                        <div style="display: flex; gap: 8px;">
                            <input type="text" id="apiKeyInput" placeholder="http://localhost:11434" class="api-key-input" value="http://localhost:11434" style="flex: 1;">
                            <button class="setup-btn-secondary" onclick="fetchOllamaModels()" style="white-space: nowrap;">Fetch Models</button>
                        </div>
                    </div>

                    <div class="help-box">
                        <strong>üìã Quick Setup Instructions:</strong>
                        <ol>
                            <li>Install Ollama: <code>brew install ollama</code> or download from <a href="https://ollama.ai" target="_blank">ollama.ai</a></li>
                            <li>Pull a model: <code>ollama pull llama3.1</code></li>
                            <li>Start Ollama: <code>ollama serve</code></li>
                            <li>Click "Fetch Models" to load your available models</li>
                        </ol>
                    </div>

                    <div class="model-selection" id="modelSelection">
                        <label>Choose Model</label>
                        <select id="modelSelect" class="model-select" disabled>
                            <option value="">Click "Fetch Models" first</option>
                        </select>
                    </div>
                </div>

                <div class="setup-actions">
                    <button class="setup-btn-primary" id="completeSetupBtn" onclick="completeLocalSetup()" disabled style="opacity: 0.5; cursor: not-allowed;">Complete Setup ‚Üí</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Agent Creator Modal -->
    <div id="agentCreatorModal" class="settings-modal" style="display: none;">
        <div class="settings-content">
            <div class="settings-header">
                <h2>‚ú® Create New Agent</h2>
                <button class="close-btn" onclick="closeAgentCreator()">‚úï</button>
            </div>

            <div class="settings-body">
                <div class="setting-section">
                    <h3>Agent Name</h3>
                    <input type="text" id="agentName" class="setting-input" placeholder="e.g., Python Expert, Frontend Specialist, DevOps Engineer">
                    <p class="hint-text">Give your agent a descriptive name</p>
                </div>

                <div class="setting-section">
                    <h3>Specialization / Description</h3>
                    <textarea id="agentDescription" class="setting-input" rows="8" placeholder="Describe what this agent specializes in (markdown supported)...

Examples:
- **Python expert** specializing in data science and machine learning
- **Frontend developer** focused on React and TypeScript
- **Database architect** with PostgreSQL expertise
- **DevOps engineer** for AWS, Docker, and Kubernetes"></textarea>
                    <p class="hint-text">Supports markdown formatting</p>
                </div>
            </div>

            <div class="settings-footer">
                <button class="setup-btn-primary" onclick="saveNewAgent()">Create Agent</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="settings-modal" style="display: none;">
        <div class="settings-content">
            <div class="settings-header">
                <h2>‚öôÔ∏è Settings</h2>
                <button class="close-btn" onclick="closeSettings()">‚úï</button>
            </div>

            <div class="settings-body">
                <div class="setting-section">
                    <h3>AI Provider</h3>
                    <div style="padding: 12px; background: rgba(102, 126, 234, 0.1); border-radius: 8px;">
                        <strong>üè† Local AI (Ollama)</strong>
                        <p style="margin: 4px 0 0 0; font-size: 13px; opacity: 0.8;">100% private, runs on your machine</p>
                    </div>

                    <div class="cost-guidance" style="margin-top: 12px; padding: 12px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 8px;">
                        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 6px;">üí∞ <strong>Cost Guidance</strong></div>
                        <div style="font-size: 13px; color: var(--text-tertiary); line-height: 1.5;">
                            <strong>Local (Ollama):</strong> $0 ‚Äî runs entirely on your hardware.<br>
                            Flaco ships in local-only mode; no cloud providers are contacted.
                        </div>
                    </div>
                </div>

                <div class="setting-section">
                    <h3>Endpoint URL</h3>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="settingsApiKey" class="setting-input" placeholder="http://localhost:11434" style="flex: 1;">
                        <button class="setting-btn" onclick="fetchModelsInSettings()" style="white-space: nowrap;">Fetch Models</button>
                    </div>
                </div>

                <div class="setting-section">
                    <h3>Model</h3>
                    <select id="settingsModel" class="setting-select" disabled>
                        <option value="">Click "Fetch Models" first</option>
                    </select>
                </div>

                <div class="setting-section">
                    <h3>Support & Debugging</h3>
                    <button class="setting-btn" onclick="openLogsFolder()" style="width: 100%;">
                        üìÇ Open Logs Folder
                    </button>
                    <p class="hint-text" style="margin-top: 8px;">Access app logs for troubleshooting and support</p>
                </div>
            </div>

            <div class="settings-footer">
                <button class="setup-btn-primary" onclick="closeSettings()">Save & Close</button>
            </div>
        </div>
    </div>

    <script src="renderer.js"></script>
</body>
</html>
